<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="应用场景 当我们开发完某项功能，合并到 develop 分支后，其他人又提交了他们的代码。本来准备要上线了，这时由于某些原因，项目经理表示要撤回我们提交的代码，这个功能这次不上线了。这时候 git revert 就派上用场啦。  准备工作 我们来创建一个提交历史做实验。 首先创建一个 repo  1 2 3   mkdir git-revert-merge-commit cd git-revert">
<meta property="og:type" content="article">
<meta property="og:title" content="用 git revert 撤回 merge 了的 commit">
<meta property="og:url" content="http://example.com/git-revert-m/index.html">
<meta property="og:site_name" content="Thank IT">
<meta property="og:description" content="应用场景 当我们开发完某项功能，合并到 develop 分支后，其他人又提交了他们的代码。本来准备要上线了，这时由于某些原因，项目经理表示要撤回我们提交的代码，这个功能这次不上线了。这时候 git revert 就派上用场啦。  准备工作 我们来创建一个提交历史做实验。 首先创建一个 repo  1 2 3   mkdir git-revert-merge-commit cd git-revert">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/wp-content/uploads/2021/01/git_history.png">
<meta property="og:image" content="http://example.com/wp-content/uploads/2021/01/git_revert_failed.png">
<meta property="og:image" content="http://example.com/wp-content/uploads/2021/01/git_commit_parents.png">
<meta property="og:image" content="http://example.com/wp-content/uploads/2021/01/git_revert_m1.png">
<meta property="og:image" content="http://example.com/wp-content/uploads/2021/01/git_history.png">
<meta property="og:image" content="http://example.com/wp-content/uploads/2021/01/git_revert_m2.png">
<meta property="og:image" content="http://example.com/wp-content/uploads/2021/01/git_revert_all.png">
<meta property="article:published_time" content="2021-01-06T08:36:27.000Z">
<meta property="article:modified_time" content="2022-05-03T07:08:10.952Z">
<meta property="article:author" content="ThankIT">
<meta property="article:tag" content="git">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/wp-content/uploads/2021/01/git_history.png">

<link rel="canonical" href="http://example.com/git-revert-m/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>用 git revert 撤回 merge 了的 commit | Thank IT</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Thank IT</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">以应用为导向的个人博客。日拱一卒，功不唐捐，以此共勉。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/git-revert-m/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thank IT">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          用 git revert 撤回 merge 了的 commit
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-06 16:36:27" itemprop="dateCreated datePublished" datetime="2021-01-06T16:36:27+08:00">2021-01-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-03 15:08:10" itemprop="dateModified" datetime="2022-05-03T15:08:10+08:00">2022-05-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a><a href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"></a>应用场景</h2><p>当我们开发完某项功能，合并到 develop 分支后，其他人又提交了他们的代码。本来准备要上线了，这时由于某些原因，项目经理表示要撤回我们提交的代码，这个功能这次不上线了。这时候 git revert 就派上用场啦。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a><a href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"></a>准备工作</h2><p>我们来创建一个提交历史做实验。 首先创建一个 repo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir git-revert-merge-commit</span><br><span class="line">cd git-revert-merge-commit</span><br><span class="line">git init</span><br></pre></td></tr></table></figure>

<p>在 master 分支新建两个文件 file1, file2，提交。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;file1&#x27; &gt; file1</span><br><span class="line">git add . &amp;&amp; git commit -m &#x27;commit file 1 on master&#x27;</span><br><span class="line">echo &#x27;file2&#x27; &gt; file2</span><br><span class="line">git add . &amp;&amp; git commit -m &#x27;commit file 2 on master&#x27;</span><br></pre></td></tr></table></figure>

<p>现在我们要做一个新的 feature,我们从 master 分支切出 feature 分支来。然后新建两个文件 file3, file4，并提交。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git branch feature</span><br><span class="line">git checkout feature # 或者使用 git checkout -b feature 一键完成上述两步</span><br><span class="line">echo &#x27;file3&#x27; &gt; file3</span><br><span class="line">git add . &amp;&amp; git commit -m &#x27;file3 on feature&#x27;</span><br><span class="line">echo &#x27;file4&#x27; &gt; file4</span><br><span class="line">git add . &amp;&amp; git commit -m &#x27;file4 on feature&#x27;</span><br></pre></td></tr></table></figure>

<p>在我们开发 feature 的过程中，master 上通常还有别人的提交。这时候我们回到 master 分支上，创建文件 file5, file6 ，提交。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">echo &#x27;file5&#x27; &gt; file5</span><br><span class="line">git add . &amp;&amp; git commit -m &#x27;file 5 on master&#x27;</span><br><span class="line">echo &#x27;file6&#x27; &gt; file6</span><br><span class="line">git add . &amp;&amp; git commit -m &#x27;file 6 on master&#x27;</span><br></pre></td></tr></table></figure>

<p>OK，这个时候，我们把 feature 合并到 master 上去。先给他打个标签。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature</span><br><span class="line">git tag thumbup-feature</span><br><span class="line">git checkout master</span><br><span class="line">git pull origin master # 拉取远程 master 合并到本地 master 没有远程就跳过。</span><br><span class="line">git merge thumbup-feature --no-ff # --no-ff 是为了避免 fast-forward</span><br></pre></td></tr></table></figure>

<p>好了，其他人也没闲着，又在 master 分支上新建了 file7</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;file7&#x27; &gt; file7</span><br><span class="line">git add . &amp;&amp; git commit -m &#x27;file 7 on master&#x27;</span><br></pre></td></tr></table></figure>

<p>好了，咱们来看一眼 source tree 中的提交记录。 <img src="/wp-content/uploads/2021/01/git_history.png"></p>
<h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a><a href="#%E5%AE%9E%E9%AA%8C"></a>实验</h2><p>这时候，项目经理要求撤回你的 feature ,就是撤回 file3, file 4 on feature。 我们 merge 的 commit id 是 4ff73d0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert 4ff73d0</span><br></pre></td></tr></table></figure>

<p>会报错： <img src="/wp-content/uploads/2021/01/git_revert_failed.png"> 看下<a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-revert#git-revert--mparent-number">官方文档</a>的说法：</p>
<blockquote>
<p>-m parent-number —mainline parent-number Usually you cannot revert a merge because you do not know which side of the merge should be considered the mainline. This option specifies the parent number (starting from 1) of the mainline and allows revert to reverse the change relative to the specified parent. Reverting a merge commit declares that you will never want the tree changes brought in by the merge. As a result, later merges will only bring in tree changes introduced by commits that are not ancestors of the previously reverted merge. This may or may not be what you want.</p>
</blockquote>
<p>我们看到 merge 的 commit 有两个 parents <img src="/wp-content/uploads/2021/01/git_commit_parents.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert 4ff73d0 -m 1</span><br></pre></td></tr></table></figure>

<p>将以 file 6 on master 那次提交作为 base, 那么撤回的是 file 3, file 4。 结果如下： <img src="/wp-content/uploads/2021/01/git_revert_m1.png"> 这时候我们恢复到上面一次提交，撤销这次的 revert 操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard df521a0</span><br></pre></td></tr></table></figure>

<p><img src="/wp-content/uploads/2021/01/git_history.png"> 然后尝试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert 4ff73d0 -m 2</span><br></pre></td></tr></table></figure>

<p>将以 file 4 on feature 那次提交作为 base, 撤回 file 5, file 6. <img src="/wp-content/uploads/2021/01/git_revert_m2.png"> 如果我们继续</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert 4ff73d0 -m 1</span><br></pre></td></tr></table></figure>

<p>那么跟之前一样，将以 file 6 on master 那次提交作为 base, 撤回 file 3, file 4。 至此 file3,file4,file5,file6 全部撤销。 <img src="/wp-content/uploads/2021/01/git_revert_all.png"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><a href="#%E6%80%BB%E7%BB%93"></a>总结</h2><p>git revert -m {n} 可以用来撤销 merge 了的 commit 。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"></a>参考链接</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/35606214">当你决定去 revert 一个merge commit</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/git/" rel="tag"># git</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/octave-%E6%95%99%E7%A8%8B/" rel="prev" title="Octave 教程">
      <i class="fa fa-chevron-left"></i> Octave 教程
    </a></div>
      <div class="post-nav-item">
    <a href="/bash-shell-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="next" title="Bash Shell 学习笔记">
      Bash Shell 学习笔记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">2.</span> <span class="nav-text">准备工作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C"><span class="nav-number">3.</span> <span class="nav-text">实验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">5.</span> <span class="nav-text">参考链接</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ThankIT</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ThankIT</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
